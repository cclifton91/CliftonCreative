---
import BaseButton from "../UI/BaseButton.astro"
---

<form
	name="contact"
	method="POST"
	action="/thank-you"
	netlify-honeypot="bot-field"
	data-netlify="true"
	x-data="{
    fullname: '',
    email: '',
    phone: '',
    service: '',
    message: '',
    error: {},

    validateField(field) {
    delete this.error[field]

    switch (field) {
      case 'fullname':
        if (!this.fullname) {
          this.error.fullname = 'Full name is required'
        }
        break
      case 'email':
					if (!this.email || !this.email.includes('@')) {
						this.errors.email = 'Valid email is required'
					}
					break
				case 'phone':
					if (!this.phone) {
						this.errors.phone = 'Phone number is required'
					} else {
						const cleaned = this.phone.replace(/[^0-9]/g, '');
						if (!(cleaned.length === 10 || (cleaned.length === 11 && cleaned.startsWith('1')))) {
							this.errors.phone = 'Please enter a valid US phone number';
						}
					}
					break
				case 'message':
					if (!this.message) this.errors.message = 'Message is required'
					break
    }
  },

  validateForm() {
			this.errors = {}
	
			if (!this.fullname) this.errors.firstname = 'First name is required'
			if (!this.email || !this.email.includes('@')) this.errors.email = 'Valid email is required'
			if (!this.message) this.errors.message = 'Message is required'
	
			const cleaned = this.phone.replace(/[^0-9]/g, '');
			if (!cleaned || !(cleaned.length === 10 || (cleaned.length === 11 && cleaned.startsWith('1')))) {
				this.errors.phone = 'Please enter a valid US phone number'
			}
	
			if (Object.keys(this.errors).length === 0) {
				$el.submit()
			}
		}
	}"
	@submit.prevent="validateForm">
	<!--BOT -->
	<input type="hidden" name="form-name" value="contact" />
	<p class="hidden">
		<label
			>Don’t fill this out if you’re human:
			<input name="bot-field" />
		</label>
	</p>
	<!-- Inputs -->
	<div>
		<input
			class="w-full py-3 pl-3 mb-4 border rounded border-ccBlue"
			type="text"
			placeholder="Full Name"
			name="fullname"
			id="fullname"
			x-model="fullname"
			@input="this.errors && delete this.errors.fullname"
			@bluer="validateField('fullname')"
		/>
		<template x-if="errors.fullname">
			<p class="text-red-500 text-sm mt-1" x-text="errors.fullname"></p>
		</template>
	</div>
	<input
		class="w-full py-3 pl-3 mb-4 border rounded border-ccBlue"
		type="text"
		placeholder="Best contact email"
		id="email"
		name="email"
	/>
	<input
		class="w-full py-3 pl-3 mb-4 border rounded border-ccBlue"
		type="text"
		placeholder="Phone number"
		id="phone"
		name="phone"
	/>
	<div>
		<div class="relative mb-4">
			<select
				class="appearance-none w-full py-4 pl-3 text-xs font-semibold leading-none border rounded border-ccBlue bg-white"
				name="service">
				<option>What do you need help with?</option>
				<option>I need a website.</option>
				<option>I need branding (logo, color scheme, ect)</option>
				<option>I need both</option>
				<option>I need something else</option>
			</select>
			<div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
				<svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
					<path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"></path>
				</svg>
			</div>
		</div>
	</div>
	<textarea
		class="mb-4 w-full p-3 border rounded resize-none border-ccBlue"
		name="message"
		cols="30"
		rows="10"
		placeholder="How can I help you?"
		id=""></textarea>
	<BaseButton type="submit" variant="primary">Send</BaseButton>
</form>
